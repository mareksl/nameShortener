"use strict";const animation=function(){function e(e){e.classList.remove("notification--visible");const t=document.querySelectorAll(".notification"),n=[];for(let e=t.length;e--;n.unshift(t[e]));n.reverse();for(let t=n.indexOf(e)+1;t<n.length;t++){let s=isNaN(parseInt(n[t].style.top))?0:parseInt(n[t].style.top);s-=e.computedHeight,n[t].style.top=s+"px"}e.addEventListener("transitionend",function(t){e.remove()})}return{notify:function(t,n){const s=(n=n||{}).time||2500,l=document.createElement("div"),o=document.createTextNode(t),a=document.createElement("span");if(a.classList.add("notification__message"),a.appendChild(o),l.appendChild(a),l.classList.add("notification"),void 0!==n.type&&l.classList.add("notification--"+n.type),"error"!==n.type&&"confirm"!==n.type&&setTimeout(function(){e(l)},s),"error"===n.type){const t=document.createElement("button");t.classList.add("notification__close"),t.innerHTML="&#10060;",t.setAttribute("aria-label","Close Notification"),t.tabIndex=1,t.addEventListener("click",function(){e(l)}),l.appendChild(t)}if("confirm"===n.type){const t=document.createElement("div");t.classList.add("notification__buttons");const s=document.createElement("button"),o=document.createElement("button");s.classList.add("button","button--narrow"),s.innerHTML="OK",s.addEventListener("click",function(){n.callback(),e(l)}),o.classList.add("button","button--narrow"),o.innerHTML="Cancel",o.addEventListener("click",function(){e(l)}),t.appendChild(s),t.appendChild(o),l.appendChild(t)}document.body.appendChild(l),l.computedHeight=l.offsetHeight+parseFloat(window.getComputedStyle(l,null).getPropertyValue("margin-top"))/2;const u=document.querySelectorAll(".notification");for(let e=0;e<u.length-1;++e){let t=isNaN(parseInt(u[e].style.top))?0:parseInt(u[e].style.top);t+=l.computedHeight,u[e].style.top=t+"px"}setTimeout(function(){l.classList.add("notification--visible")},0)}}}(),nameChecker=function(){function e(e,t){var n=e;for(let e in t)if(t.hasOwnProperty(e)){const s=new RegExp(e,"g");n=n.replace(s,t[e])}return n}function t(t){return e(t,{"Ä":"Ae","Ö":"Oe","Ü":"ue","ä":"ae","ö":"oe","ü":"ue","ß":"ss"})}function n(t){return e(t,{"/":"%2F"})}function s(t){return e(t,{"[()]":""})}function l(t){return e(t,{"\n":" "})}function o(t){return e(t,{"-":" "})}function a(t){return e(t,{"\\s":""})}function u(t){return e(t,{"\\s\\s+":" "})}function r(t,n){const s={};return s[n]="",e(t,s)}function i(e,t){const n=[];for(let s=0;s<t.length;s++)""!==t[s]&&n.push(e+" "+t[s]);return n}function c(e,t,n,s){function l(e,t,n){if(e.length<=n)return e;{const a=[];for(let n in t)if(t.hasOwnProperty(n)&&n.length>t[n].replacements[0].length){const l=new RegExp(n,"gi");for(var s;null!=(s=l.exec(e));){const e=[];e.push(s),e.push(t[n]),e.push(s.index),a.push(e)}}if(a.length<1)return e;{var o=e;a.sort(function(e,t){const n=e[1].priority,s=t[1].priority,l=e[2],o=t[2];return n==s?o-l:s-n});const s=a[0][2];return o=o.substring(0,s)+o.substring(s).replace(a[0][0],a[0][1].replacements[0]),o=l(o,t,n)}}}const o=[],a=i(e,t);var u=e;a.length>0&&(u=a.reduce(function(e,t){return e.length>t.length?e:t}));const r=u.length-e.length,c=s.map(function(e){return e-r});for(let t=0;t<c.length;t++){const s=l(e,n,c[t]);o.push(s)}return o}return Object.prototype.hasOwnPropertyCI=function(e){return Object.keys(this).filter(function(t){return t.toLowerCase()===e.toLowerCase()}).length>0},{replaceUmlauts:t,maxLength:function(e,t){return e.length>t},removeBreaks:l,translateLink:function(e){return"https://translate.google.com/#auto/en/"+n(encodeURI(l(e)))},addShareClasses:i,shortenProcess:function(e,n,l,m,d,p){var h=e;h=n.removeRegex?r(h,p):h,h=n.removeParens?s(h):h,h=n.removeDashes?o(h):h,h=n.removeWhitespace?a(h):h,h=u(h=n.replaceUmlauts?t(h):h),h=n.shortenName?c(h,m,l,d):[h,h,h];for(let e=0;e<h.length;e++){const t=2===e?"In-House":1===e?"Short":"";(m.length>0?i(h[e],m).reduce(function(e,t){return e.length>t.length?e:t}):h[e]).length>d[e]&&animation.notify("Couldn't fully shorten "+t+" Name.",{type:"warning"})}return{shortenedName:h[0],shortenedNameShort:h[1],shortenedNameInHouse:h[2]}}}}(),loadRules=function(){return{load:function(e){if(localStorage.localRulesSaved=!0,void 0!==localStorage.localRules)e(localStorage.localRules),animation.notify("Local rules loaded!",{type:"success"});else{animation.notify("No local rules found!",{type:"warning"});const t=new XMLHttpRequest;t.overrideMimeType("application/json"),t.open("GET","js/rules.json",!0),t.onreadystatechange=function(){4==t.readyState&&("200"==t.status?(e(t.responseText),animation.notify("Default rules loaded!",{type:"success"})):(e("{}"),animation.notify("No default rules found! Please add own rules.",{type:"error"})))},t.send(null)}},modify:function(e,t,n){"saved"===t?(localStorage.localRules=JSON.stringify(e),localStorage.localRulesSaved=!0):"changed"===t&&(localStorage.localRulesSaved=!1),n()},uploadRules:function(e,t){const n=["json","txt"],s=e.target;if(s.files&&s.files[0]){const e=s.files[0].name.split(".").pop().toLowerCase();if(n.indexOf(e)<0)animation.notify("Only .json and .txt files allowed!",{type:"error"});else if(s.files[0].size>1e6)animation.notify("Max. "+Math.floor(1)+"MB allowed",{type:"error"});else{const e=new FileReader;e.onloadstart=function(e){animation.notify("Uploading rules.")},e.onerror=function(e){animation.notify("Upload not successful.",{type:"error"})},e.onload=function(){t(e.result),animation.notify("Rules uploaded successfully.",{type:"success"})},e.readAsText(s.files[0])}}}}}(),elements={inputName:document.querySelector("#inputName"),outputName:document.querySelector("#outputName"),outputShortName:document.querySelector("#outputShortName"),outputInHouseName:document.querySelector("#outputInHouseName"),lenOutputName:document.querySelector("#lenOutputName"),lenOutputShortName:document.querySelector("#lenOutputShortName"),lenOutputInHouseName:document.querySelector("#lenOutputInHouseName"),lenName:document.querySelector("#lenName"),inputObj:document.querySelector("#inputObj"),lenObj:document.querySelector("#lenObj"),showRules:document.querySelector("#showRules"),divRules:document.querySelector("#sectionRules"),shareClassesOutput:document.querySelector("#shareClassesOutput"),shareClassesShortOutput:document.querySelector("#shareClassesShortOutput"),shareClassesInHouseOutput:document.querySelector("#shareClassesInHouseOutput"),shareClassesInput:document.querySelector("#shareClasses"),btnsRules:document.querySelector("#btnsRules"),btnSaveRules:document.querySelector("#btnSaveRules"),btnResetRules:document.querySelector("#btnResetRules"),btnCloseRules:document.querySelector("#btnCloseRules"),btnRemoveRules:document.querySelector("#btnRemoveRules"),btnDownloadRules:document.querySelector("#btnDownloadRules"),btnUploadRules:document.querySelector("#btnUploadRules"),rulesSaved:document.querySelector("#rulesSaved"),tableRules:document.querySelector("#tableRules"),tableBody:document.querySelector("#tableRules tbody"),btnAddRule:document.querySelector("#btnAddRule"),buttonShorten:document.querySelector("#buttonShorten"),addRuleKey:document.querySelector("#addRuleKey"),addRuleValue:document.querySelector("#addRuleValue"),addRulePriority:document.querySelector("#addRulePriority"),btnObjUmlauts:document.querySelector("#buttonObjUmlauts"),btnObjBreaks:document.querySelector("#buttonObjBreaks"),linkTranslate:document.querySelector("#linkTranslate"),btnExportNames:document.querySelector("#btnExportNames"),removeSpecial:document.querySelector("#removeSpecial"),removeParens:document.querySelector("#removeParens"),shortenNames:document.querySelector("#shortenNames"),removeDashes:document.querySelector("#removeDashes"),removeWhitespace:document.querySelector("#removeWhitespace"),manualWrapper:document.querySelector("#manualWrapper"),manualClose:document.querySelector("#manualClose"),manualOpen:document.querySelector("#manualOpen"),removeRegex:document.querySelector("#removeRegex")};!function(e){function t(e,t,n){t.innerHTML=e.length,nameChecker.maxLength(e,n)?t.classList.contains("length--warning")||t.classList.add("length--warning"):t.classList.contains("length--warning")&&t.classList.remove("length--warning")}function n(e){const t=document.createRange();t.selectNodeContents(e);const n=window.getSelection();n.removeAllRanges(),n.addRange(t)}function s(e){n(e);try{let e=document.execCommand("copy"),t=e?"successful":"unsuccessful",n=e?"success":"error";animation.notify("Copying text was "+t+"!",{type:n})}catch(e){animation.notify("Unable to copy!",{type:"error"})}}function l(e,n,l,o){const a=n.value.length>0?n.value.split("\n"):[];for(;l.firstChild;)l.removeChild(l.firstChild);let u=nameChecker.addShareClasses(e,a);for(let e=0;e<u.length;e++){let n=l.id+"_"+e,a=document.createElement("li");a.setAttribute("tabIndex","0"),a.setAttribute("contentEditable","true"),a.classList+="shareclass-list__item";let r=document.createTextNode(u[e]);a.appendChild(r);let i=document.createElement("span");i.setAttribute("id",n),i.setAttribute("data-tooltip","Copy"),i.classList+="shareclass-list__length",t(r,i,o),l.appendChild(a),l.appendChild(i),i.addEventListener("click",function(){s(a)})}}function o(e){loadRules.modify(c,e,function(){"saved"===e?(animation.notify("Local rules saved!",{type:"success"}),elements.rulesSaved.innerHTML="",elements.btnSaveRules.classList.remove("button--unsaved")):"changed"===e&&(elements.rulesSaved.innerHTML="*",elements.btnSaveRules.classList.add("button--unsaved"))})}function a(e,t,n,s){let l=document.createElement("tr"),a=document.createElement("td"),u=document.createElement("td"),r=document.createElement("td"),i=document.createElement("td"),m=document.createElement("button");l.classList+="table-rules__row",a.classList+="table-rules__item",u.classList+="table-rules__item",r.classList+="table-rules__item table-rules__item--narrower",i.classList+="table-rules__item table-rules__item--narrow",m.innerHTML="Remove",m.classList+="button button--intable",a.innerHTML=t,u.innerHTML=n,r.innerHTML=s,i.appendChild(m),l.appendChild(a),l.appendChild(u),l.appendChild(r),l.appendChild(i),e.appendChild(l),m.addEventListener("click",function(n){delete c[t],o("changed"),e.removeChild(l)})}function u(e,t){t.innerHTML="";try{for(let n in e)e.hasOwnProperty(n)&&a(t,n,e[n].replacements[0],e[n].priority)}catch(e){animation.notify("There was a problem loading local rules. Please reset to default or remove all rules.",{type:"error"})}}function r(){loadRules.load(function(e){u(c=JSON.parse(e),elements.tableBody)})}function i(n,s,o,a){const u=n.value,r=e[o];t(u,s,r),l(u,elements.shareClassesInput,a,r)}var c;r(),elements.btnAddRule.addEventListener("click",function(e){const t=elements.addRuleKey.value,n=elements.addRuleValue.value,s=elements.addRulePriority.value<=99?elements.addRulePriority.value:99;""!==t&&""!==n?c.hasOwnPropertyCI(t)?animation.notify("Rule already exists!",{type:"warning"}):(c[t]={priority:s,replacements:[n]},o("changed"),a(elements.tableBody,t,n,s),elements.addRuleKey.value="",elements.addRuleValue.value="",elements.addRulePriority.value="0"):animation.notify("Please check rule input!",{type:"warning"})}),elements.addRulePriority.addEventListener("input",function(e){elements.addRulePriority.value=elements.addRulePriority.value.replace(/\D+/g,"")}),elements.btnsRules.addEventListener("click",function(e){switch(e.target){case elements.btnSaveRules:o("saved");break;case elements.btnResetRules:animation.notify("Do you want to reset to default rules?",{type:"confirm",callback:function(){animation.notify("Rules reset to default!"),localStorage.removeItem("localRules"),localStorage.removeItem("localRulesSaved"),r()}});break;case elements.btnRemoveRules:animation.notify("Do you want to remove all rules?",{type:"confirm",callback:function(){for(c={};elements.tableBody.firstChild;)elements.tableBody.removeChild(elements.tableBody.firstChild);o("changed")}});break;case elements.btnDownloadRules:const t="data:text/json;charset=utf-8,"+JSON.stringify(c),n=encodeURI(t),s=document.createElement("a");s.setAttribute("href",n),s.setAttribute("download","rules.json"),animation.notify("Exporting to JSON!"),document.body.appendChild(s),s.click(),document.body.removeChild(s);break;case elements.btnUploadRules:e.target.value=null;break;case elements.btnCloseRules:elements.divRules.classList.remove("section__rules--show")}}),elements.btnUploadRules.addEventListener("change",function(e){loadRules.uploadRules(e,function(e){u(c=JSON.parse(e),elements.tableBody),o("changed")})}),window.addEventListener("beforeunload",function(e){if("false"===localStorage.localRulesSaved){return e.returnValue="You have unsaved rules!","You have unsaved rules!"}}),elements.inputName.addEventListener("input",function(n){t(elements.inputName.value,elements.lenName,e[0])}),elements.inputName.addEventListener("keydown",function(e){13===e.which&&elements.buttonShorten.click()}),elements.outputName.addEventListener("input",function(e){i(elements.outputName,elements.lenOutputName,0,elements.shareClassesOutput)}),elements.outputShortName.addEventListener("input",function(e){i(elements.outputShortName,elements.lenOutputShortName,1,elements.shareClassesShortOutput)}),elements.outputInHouseName.addEventListener("input",function(e){i(elements.outputInHouseName,elements.lenOutputInHouseName,2,elements.shareClassesInHouseOutput)}),elements.buttonShorten.addEventListener("click",function(t){const n=elements.inputName.value,s={};s.replaceUmlauts=elements.removeSpecial.checked,s.removeParens=elements.removeParens.checked,s.shortenName=elements.shortenNames.checked,s.removeDashes=elements.removeDashes.checked,s.removeWhitespace=elements.removeWhitespace.checked,s.removeRegex=""!==elements.removeRegex.value;const l=elements.removeRegex.value,o=elements.shareClassesInput.value.length>0?elements.shareClassesInput.value.split("\n"):[],a=nameChecker.shortenProcess(n,s,c,o,e,l);elements.outputName.value=a.shortenedName,elements.outputShortName.value=a.shortenedNameShort,elements.outputInHouseName.value=a.shortenedNameInHouse,i(elements.outputName,elements.lenOutputName,0,elements.shareClassesOutput),i(elements.outputShortName,elements.lenOutputShortName,1,elements.shareClassesShortOutput),i(elements.outputInHouseName,elements.lenOutputInHouseName,2,elements.shareClassesInHouseOutput)}),elements.inputObj.addEventListener("input",function(e){t(elements.inputObj.value,elements.lenObj,2e3),elements.linkTranslate.href=nameChecker.translateLink(elements.inputObj.value)}),elements.btnObjUmlauts.addEventListener("click",function(e){elements.inputObj.value=nameChecker.replaceUmlauts(elements.inputObj.value),t(elements.inputObj.value,elements.lenObj,2e3),elements.inputObj.select()}),elements.btnObjBreaks.addEventListener("click",function(e){elements.inputObj.value=nameChecker.removeBreaks(elements.inputObj.value),t(elements.inputObj.value,elements.lenObj,2e3),elements.inputObj.select()}),elements.showRules.addEventListener("click",function(e){elements.divRules.classList.contains("section__rules--show")?elements.divRules.classList.remove("section__rules--show"):elements.divRules.classList.add("section__rules--show")}),elements.shareClassesInput.addEventListener("input",function(e){const t=e.target;t.style.height="inherit",t.style.height=t.scrollHeight+4+"px"});const m=function(){const e=elements.shareClassesOutput.getElementsByTagName("li"),t=elements.shareClassesShortOutput.getElementsByTagName("li"),n=elements.shareClassesInHouseOutput.getElementsByTagName("li");if(0===e.length&&0===t.length&&0===n.length)animation.notify("Nothing to export!",{type:"error"});else{const s=[["Name","Short Name","In-House Name"]];for(let l=0;l<e.length;l++){let o=[];o[0]=e[l].innerHTML,o[1]=t[l].innerHTML,o[2]=n[l].innerHTML,s.push(o)}const l=[];s.forEach(function(e,t){const n=e.join(",");l.push(0==t?"data:text/csv;charset=utf-8,"+n:n)});const o=l.join("\n"),a=encodeURI(o),u=document.createElement("a");u.setAttribute("href",a),u.setAttribute("download","names.csv"),animation.notify("Exporting to CSV!"),document.body.appendChild(u),u.click(),document.body.removeChild(u)}};elements.btnExportNames.addEventListener("click",function(){m()}),elements.manualOpen.addEventListener("click",function(e){elements.manualWrapper.style.display="flex",elements.manualWrapper.classList.add("manual--visible")}),elements.manualClose.addEventListener("click",function(e){elements.manualWrapper.classList.remove("manual--visible"),elements.manualWrapper.addEventListener("transitionend",function(e){})}),elements.manualWrapper.addEventListener("click",function(e){e.target==elements.manualWrapper&&(elements.manualWrapper.classList.remove("manual--visible"),elements.manualWrapper.addEventListener("transitionend",function(e){}))})}([50,30,40]);