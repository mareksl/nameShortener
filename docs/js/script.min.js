"use strict";const animation=function(){function e(e){e.classList.remove("notification--visible");const t=document.querySelectorAll(".notification"),n=[];for(let e=t.length;e--;n.unshift(t[e]));n.reverse();for(let t=n.indexOf(e)+1;t<n.length;t++){let s=isNaN(parseInt(n[t].style.top))?0:parseInt(n[t].style.top);s-=e.computedHeight,n[t].style.top=s+"px"}e.addEventListener("transitionend",function(t){e.remove()})}return{notify:function(t,n){!function(e){document.body.appendChild(e),e.computedHeight=e.offsetHeight+parseFloat(window.getComputedStyle(e,null).getPropertyValue("margin-top"))/2;const t=document.querySelectorAll(".notification");for(let n=0;n<t.length-1;++n){let s=isNaN(parseInt(t[n].style.top))?0:parseInt(t[n].style.top);s+=e.computedHeight,t[n].style.top=s+"px"}setTimeout(function(){e.classList.add("notification--visible")},0)}(function(t,n){const s=(n=n||{}).time||2500,l=document.createElement("div"),o=document.createTextNode(t),a=document.createElement("span");if(a.classList.add("notification__message"),a.appendChild(o),l.appendChild(a),l.classList.add("notification"),void 0!==n.type&&l.classList.add("notification--"+n.type),"error"===n.type){const t=document.createElement("button");t.classList.add("notification__close"),t.innerHTML="&times;",t.setAttribute("aria-label","Close Notification"),t.tabIndex=1,t.addEventListener("click",function(){e(l)}),l.appendChild(t)}if("confirm"===n.type){const t=document.createElement("div");t.classList.add("notification__buttons");const s=document.createElement("button"),o=document.createElement("button");s.classList.add("button","button--narrow"),s.innerHTML="OK",s.addEventListener("click",function(){n.callback(),e(l)}),o.classList.add("button","button--narrow"),o.innerHTML="Cancel",o.addEventListener("click",function(){e(l)}),t.appendChild(s),t.appendChild(o),l.appendChild(t)}return"error"!==n.type&&"confirm"!==n.type&&setTimeout(function(){e(l)},s),l}(t,n))}}}(),nameChecker=function(){function e(e,t){let n=e;for(let e in t)if(t.hasOwnProperty(e)){const s=new RegExp(e,"g");n=n.replace(s,t[e])}return n}function t(t){return e(t,{"Ä":"Ae","Ö":"Oe","Ü":"ue","ä":"ae","ö":"oe","ü":"ue","ß":"ss"})}function n(t){return e(t,{"\n":" "})}function s(e,t){const n=[];for(let s=0;s<t.length;s++)""!==t[s]&&n.push(e+" "+t[s]);return n}function l(e,t,n){if(e.length<=n)return e;{const s=function(e,t){const n=[];for(let s in t)if(t.hasOwnProperty(s)&&s.length>t[s].replacements[0].length){const l=new RegExp(s,"gi");let o;for(;null!=(o=l.exec(e));){const e=[];e.push(o),e.push(t[s]),e.push(o.index),n.push(e)}}return n}(e,t);if(s.length<1)return e;return l(function(e,t){const n=function(e){return e.sort(function(e,t){const n=e[1].priority,s=t[1].priority,l=e[2],o=t[2];return n==s?o-l:s-n})}(t),s=n[0][2];return e.substring(0,s)+e.substring(s).replace(n[0][0],n[0][1].replacements[0])}(e,s),t,n)}}return Object.prototype.hasOwnPropertyCI=function(e){return Object.keys(this).filter(function(t){return t.toLowerCase()===e.toLowerCase()}).length>0},{replaceUmlauts:t,maxLength:function(e,t){return e.length>t},removeBreaks:n,translateLink:function(t){return"https://translate.google.com/#auto/en/"+function(t){return e(t,{"/":"%2F"})}(encodeURI(n(t)))},addShareClasses:s,shortenProcess:function(n,o,a,u,r,i){const c=o.removeRegex?function(t,n){const s={};s[n]="";try{return e(t,s)}catch(e){if("SyntaxError"===e.name)return animation.notify(e.message,{type:"error"}),t}}(n,i):n,m=o.removeParens?e(c,{"[()]":""}):c,d=o.removeDashes?function(t){return e(t,{"-":" "})}(m):m,p=o.removeWhitespace?function(t){return e(t,{"\\s":""})}(d):d,h=function(t){return e(t,{"\\s\\s+":" "})}(o.replaceUmlauts?t(p):p),f=o.shortenName?function(e,t,n,o){const a=[],u=s(e,t);let r=e;u.length>0&&(r=u.reduce(function(e,t){return e.length>t.length?e:t}));const i=r.length-e.length,c=o.map(function(e){return e-i});for(let t=0;t<c.length;t++){const s=l(e,n,c[t]);a.push(s)}return a}(h,u,a,r):[h,h,h];return o.shortenName&&function(e,t,n){for(let l=0;l<e.length;l++){const o=2===l?"In-House":1===l?"Short":"";let a;(a=t.length>0?s(e[l],t).reduce(function(e,t){return e.length>t.length?e:t}):e[l]).length>n[l]&&animation.notify("Couldn't fully shorten "+o+" Name.",{type:"warning"})}}(f,u,r),{shortenedName:f[0],shortenedNameShort:f[1],shortenedNameInHouse:f[2]}}}}(),loadRules=function(){return{load:function(e){if(localStorage.localRulesSaved=!0,void 0!==localStorage.localRules)e(localStorage.localRules),animation.notify("Local rules loaded!",{type:"success"});else{animation.notify("No local rules found!",{type:"warning"});const t=new XMLHttpRequest;t.overrideMimeType("application/json"),t.open("GET","js/rules.json",!0),t.onreadystatechange=function(){4==t.readyState&&("200"==t.status?(e(t.responseText),animation.notify("Default rules loaded!",{type:"success"})):(e("{}"),animation.notify("No default rules found! Please add own rules.",{type:"error"})))},t.send(null)}},modify:function(e,t,n){"saved"===t?(localStorage.localRules=JSON.stringify(e),localStorage.localRulesSaved=!0):"changed"===t&&(localStorage.localRulesSaved=!1),n()},uploadRules:function(e,t){const n=["json","txt"],s=e.target;if(s.files&&s.files[0]){const e=s.files[0].name.split(".").pop().toLowerCase();if(n.indexOf(e)<0)animation.notify("Only .json and .txt files allowed!",{type:"error"});else if(s.files[0].size>1e6)animation.notify("Max. "+Math.floor(1)+"MB allowed",{type:"error"});else{const e=new FileReader;e.onloadstart=function(e){animation.notify("Uploading rules.")},e.onerror=function(e){animation.notify("Upload not successful.",{type:"error"})},e.onload=function(){t(e.result),animation.notify("Rules uploaded successfully.",{type:"success"})},e.readAsText(s.files[0])}}}}}(),elements={inputName:document.querySelector("#inputName"),outputName:document.querySelector("#outputName"),outputShortName:document.querySelector("#outputShortName"),outputInHouseName:document.querySelector("#outputInHouseName"),lenOutputName:document.querySelector("#lenOutputName"),lenOutputShortName:document.querySelector("#lenOutputShortName"),lenOutputInHouseName:document.querySelector("#lenOutputInHouseName"),lenName:document.querySelector("#lenName"),inputObj:document.querySelector("#inputObj"),lenObj:document.querySelector("#lenObj"),showRules:document.querySelector("#showRules"),divRules:document.querySelector("#sectionRules"),shareClassesOutput:document.querySelector("#shareClassesOutput"),shareClassesShortOutput:document.querySelector("#shareClassesShortOutput"),shareClassesInHouseOutput:document.querySelector("#shareClassesInHouseOutput"),shareClassesInput:document.querySelector("#shareClasses"),btnsRules:document.querySelector("#btnsRules"),btnSaveRules:document.querySelector("#btnSaveRules"),btnResetRules:document.querySelector("#btnResetRules"),btnCloseRules:document.querySelector("#btnCloseRules"),btnRemoveRules:document.querySelector("#btnRemoveRules"),btnDownloadRules:document.querySelector("#btnDownloadRules"),btnUploadRules:document.querySelector("#btnUploadRules"),rulesSaved:document.querySelector("#rulesSaved"),tableRules:document.querySelector("#tableRules"),tableBody:document.querySelector("#tableRules tbody"),btnAddRule:document.querySelector("#btnAddRule"),buttonShorten:document.querySelector("#buttonShorten"),addRuleKey:document.querySelector("#addRuleKey"),addRuleValue:document.querySelector("#addRuleValue"),addRulePriority:document.querySelector("#addRulePriority"),btnObjUmlauts:document.querySelector("#buttonObjUmlauts"),btnObjBreaks:document.querySelector("#buttonObjBreaks"),linkTranslate:document.querySelector("#linkTranslate"),btnExportNames:document.querySelector("#btnExportNames"),removeSpecial:document.querySelector("#removeSpecial"),removeParens:document.querySelector("#removeParens"),shortenNames:document.querySelector("#shortenNames"),removeDashes:document.querySelector("#removeDashes"),removeWhitespace:document.querySelector("#removeWhitespace"),manualWrapper:document.querySelector("#manualWrapper"),manualClose:document.querySelector("#manualClose"),manualOpen:document.querySelector("#manualOpen"),removeRegex:document.querySelector("#removeRegex"),expandableTextareas:document.querySelectorAll(".textarea--expandable")};!function(e){let t;function n(e,t,n){t.innerHTML=e.length,nameChecker.maxLength(e,n)?t.classList.contains("length--warning")||t.classList.add("length--warning"):t.classList.contains("length--warning")&&t.classList.remove("length--warning")}function s(e){!function(e){const t=document.createRange();t.selectNodeContents(e);const n=window.getSelection();n.removeAllRanges(),n.addRange(t)}(e);try{const e=document.execCommand("copy"),t=e?"successful":"unsuccessful",n=e?"success":"error";animation.notify("Copying text was "+t+"!",{type:n})}catch(e){animation.notify("Unable to copy!",{type:"error"})}}function l(e){const t=e.target;t.style.height="inherit",t.style.height=t.scrollHeight+4+"px"}function o(e,t){e.addEventListener("click",function(){s(t)})}function a(e,t,s,l){const a=t&&t.length>0?t.split("\n"):[];for(;s.firstChild;)s.removeChild(s.firstChild);!function(e,t,s){for(let l=0;l<e.length;l++){const a=t.id+"_"+l,u=document.createElement("li");u.setAttribute("tabIndex","0"),u.setAttribute("contentEditable","true"),u.classList+="shareclass-list__item";const r=document.createTextNode(e[l]);u.appendChild(r);const i=document.createElement("span");i.setAttribute("id",a),i.setAttribute("data-tooltip","Copy"),i.classList+="shareclass-list__length",n(r,i,s),t.appendChild(u),t.appendChild(i),o(i,u)}}(nameChecker.addShareClasses(e,a),s,l)}function u(t,s,l,o,u,r){const i=e[l];n(t,s,i),a(t,o,u,i)}function r(e){loadRules.modify(t,e,function(){"saved"===e?(animation.notify("Local rules saved!",{type:"success"}),elements.rulesSaved.innerHTML="",elements.btnSaveRules.classList.remove("button--unsaved")):"changed"===e&&(elements.rulesSaved.innerHTML="*",elements.btnSaveRules.classList.add("button--unsaved"))})}function i(e,n,s,l){const o=document.createElement("tr"),a=document.createElement("td"),u=document.createElement("td"),i=document.createElement("td"),c=document.createElement("td"),m=document.createElement("button");o.classList+="table-rules__row",a.classList+="table-rules__item",u.classList+="table-rules__item",i.classList+="table-rules__item table-rules__item--narrower",c.classList+="table-rules__item table-rules__item--narrow",m.innerHTML="Remove",m.classList+="button button--intable",a.innerHTML=n,u.innerHTML=s,i.innerHTML=l,c.appendChild(m),o.appendChild(a),o.appendChild(u),o.appendChild(i),o.appendChild(c),e.appendChild(o),m.addEventListener("click",function(s){!function(e,n,s){delete t[e],r("changed"),n.removeChild(s)}(n,e,o)})}function c(e,t){t.innerHTML="";try{const n={};Object.keys(e).sort().forEach(function(t){n[t]=e[t]});for(let e in n)n.hasOwnProperty(e)&&i(t,e,n[e].replacements[0],n[e].priority)}catch(e){animation.notify("There was a problem loading local rules. Please reset to default or remove all rules.",{type:"error"})}}function m(){loadRules.load(function(e){c(t=JSON.parse(e),elements.tableBody)})}function d(){elements.manualWrapper.classList.remove("manual--visible"),elements.manualWrapper.addEventListener("transitionend",function(e){})}function p(){window.open("https://goo.gl/forms/t65D5Cmutpq5HKlJ2","_blank"),localStorage.setItem("surveyTaken","true")}m(),elements.showRules.addEventListener("click",function(e){elements.divRules.classList.contains("section__rules--show")?elements.divRules.classList.remove("section__rules--show"):elements.divRules.classList.add("section__rules--show")}),elements.btnAddRule.addEventListener("click",function(e){!function(e,n,s,l){const o=s<=99?s:99;""!==e&&""!==n?t.hasOwnPropertyCI(e)?animation.notify("Rule already exists!",{type:"warning"}):(t[e]={priority:o,replacements:[n]},r("changed"),i(elements.tableBody,e,n,s),l()):animation.notify("Please check rule input!",{type:"warning"})}(elements.addRuleKey.value,elements.addRuleValue.value,elements.addRulePriority.value,function(){elements.addRuleKey.value="",elements.addRuleValue.value="",elements.addRulePriority.value=0,elements.tableBody.scrollTop=elements.tableBody.scrollHeight})}),elements.btnsRules.addEventListener("click",function(e){switch(e.target){case elements.btnSaveRules:r("saved");break;case elements.btnResetRules:animation.notify("Do you want to reset to default rules?",{type:"confirm",callback:function(){animation.notify("Rules reset to default!"),localStorage.removeItem("localRules"),localStorage.removeItem("localRulesSaved"),t=m()}});break;case elements.btnRemoveRules:animation.notify("Do you want to remove all rules?",{type:"confirm",callback:function(){for(t={};elements.tableBody.firstChild;)elements.tableBody.removeChild(elements.tableBody.firstChild);r("changed")}});break;case elements.btnDownloadRules:const n="data:text/json;charset=utf-8,"+JSON.stringify(t),s=encodeURI(n),l=document.createElement("a");l.setAttribute("href",s),l.setAttribute("download","rules.json"),animation.notify("Exporting to JSON!"),document.body.appendChild(l),l.click(),document.body.removeChild(l);break;case elements.btnUploadRules:e.target.value=null;break;case elements.btnCloseRules:elements.divRules.classList.remove("section__rules--show")}}),elements.btnUploadRules.addEventListener("change",function(e){loadRules.uploadRules(e,function(e){try{c(t=JSON.parse(e),elements.tableBody),r("changed")}catch(e){animation.notify(e,{type:"error"})}})}),window.addEventListener("beforeunload",function(e){if("false"===localStorage.localRulesSaved){const t="You have unsaved rules!";return e.returnValue=t,t}}),function(){elements.addRulePriority.addEventListener("input",function(e){elements.addRulePriority.value=elements.addRulePriority.value.replace(/\D+/g,"")}),elements.inputName.addEventListener("input",function(t){n(elements.inputName.value,elements.lenName,e[0])}),elements.inputName.addEventListener("keydown",function(e){13===e.which&&elements.buttonShorten.click()}),elements.outputName.addEventListener("input",function(e){u(elements.outputName.value,elements.lenOutputName,0,elements.shareClassesInput.value,elements.shareClassesOutput)}),elements.outputShortName.addEventListener("input",function(e){u(elements.outputShortName.value,elements.lenOutputShortName,1,elements.shareClassesInput.value,elements.shareClassesShortOutput)}),elements.outputInHouseName.addEventListener("input",function(e){u(elements.outputInHouseName.value,elements.lenOutputInHouseName,2,elements.shareClassesInput.value,elements.shareClassesInHouseOutput)});for(let e=0;e<elements.expandableTextareas.length;e++){elements.expandableTextareas[e].addEventListener("input",l)}}(),elements.buttonShorten.addEventListener("click",function(n){const s=elements.inputName.value,l={};l.replaceUmlauts=elements.removeSpecial.checked,l.removeParens=elements.removeParens.checked,l.shortenName=elements.shortenNames.checked,l.removeDashes=elements.removeDashes.checked,l.removeWhitespace=elements.removeWhitespace.checked,l.removeRegex=""!==elements.removeRegex.value;const o=elements.removeRegex.value,a=elements.shareClassesInput.value.length>0?elements.shareClassesInput.value.split("\n"):[],r=nameChecker.shortenProcess(s,l,t,a,e,o);elements.outputName.value=r.shortenedName,elements.outputShortName.value=r.shortenedNameShort,elements.outputInHouseName.value=r.shortenedNameInHouse,u(r.shortenedName,elements.lenOutputName,0,elements.shareClassesInput.value,elements.shareClassesOutput),u(r.shortenedNameShort,elements.lenOutputShortName,1,elements.shareClassesInput.value,elements.shareClassesShortOutput),u(r.shortenedNameInHouse,elements.lenOutputInHouseName,2,elements.shareClassesInput.value,elements.shareClassesInHouseOutput)}),elements.btnExportNames.addEventListener("click",function(){!function(){const e=elements.shareClassesOutput.getElementsByTagName("li"),t=elements.shareClassesShortOutput.getElementsByTagName("li"),n=elements.shareClassesInHouseOutput.getElementsByTagName("li");if(0===e.length&&0===t.length&&0===n.length)animation.notify("Nothing to export!",{type:"error"});else{const s=[["Name","Short Name","In-House Name"]];for(let l=0;l<e.length;l++){const o=[];o[0]=e[l].innerHTML,o[1]=t[l].innerHTML,o[2]=n[l].innerHTML,s.push(o)}const l=[];s.forEach(function(e,t){const n=e.join(",");l.push(0==t?"data:text/csv;charset=utf-8,"+n:n)});const o=l.join("\n"),a=encodeURI(o),u=document.createElement("a");u.setAttribute("href",a),u.setAttribute("download","names.csv"),animation.notify("Exporting to CSV!"),document.body.appendChild(u),u.click(),document.body.removeChild(u)}}()}),elements.inputObj.addEventListener("input",function(e){n(elements.inputObj.value,elements.lenObj,2e3),elements.linkTranslate.href=nameChecker.translateLink(elements.inputObj.value)}),elements.btnObjUmlauts.addEventListener("click",function(e){elements.inputObj.value=nameChecker.replaceUmlauts(elements.inputObj.value),n(elements.inputObj.value,elements.lenObj,2e3),elements.inputObj.select()}),elements.btnObjBreaks.addEventListener("click",function(e){elements.inputObj.value=nameChecker.removeBreaks(elements.inputObj.value),n(elements.inputObj.value,elements.lenObj,2e3),elements.inputObj.select()}),elements.manualOpen.addEventListener("click",function(e){elements.manualWrapper.style.display="flex",elements.manualWrapper.classList.add("manual--visible")}),elements.manualWrapper.addEventListener("click",function(e){e.target==elements.manualWrapper&&d(),e.target==elements.manualClose&&d()}),"true"!==localStorage.getItem("surveyTaken")&&animation.notify("Would you like to take a short survey to improve the app?",{type:"confirm",callback:p})}([50,30,40]);