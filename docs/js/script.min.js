"use strict";const animation=function(){function e(e){document.body.appendChild(e),e.computedHeight=e.offsetHeight+parseFloat(window.getComputedStyle(e,null).getPropertyValue("margin-top"))/2;const t=document.querySelectorAll(".notification");for(let n=0;n<t.length-1;++n){let s=isNaN(parseInt(t[n].style.top))?0:parseInt(t[n].style.top);s+=e.computedHeight,t[n].style.top=s+"px"}setTimeout(function(){e.classList.add("notification--visible")},0)}function t(e){e.classList.remove("notification--visible");const t=document.querySelectorAll(".notification"),n=[];for(let e=t.length;e--;n.unshift(t[e]));n.reverse();for(let t=n.indexOf(e)+1;t<n.length;t++){let s=isNaN(parseInt(n[t].style.top))?0:parseInt(n[t].style.top);s-=e.computedHeight,n[t].style.top=s+"px"}e.addEventListener("transitionend",function(t){e.remove()})}function n(e,n){const s=(n=n||{}).time||2500,l=document.createElement("div"),o=document.createTextNode(e),a=document.createElement("span");if(a.classList.add("notification__message"),a.appendChild(o),l.appendChild(a),l.classList.add("notification"),void 0!==n.type&&l.classList.add("notification--"+n.type),"error"===n.type){const e=document.createElement("button");e.classList.add("notification__close"),e.innerHTML="&times;",e.setAttribute("aria-label","Close Notification"),e.tabIndex=1,e.addEventListener("click",function(){t(l)}),l.appendChild(e)}if("confirm"===n.type){const e=document.createElement("div");e.classList.add("notification__buttons");const s=document.createElement("button"),o=document.createElement("button");s.classList.add("button","button--narrow"),s.innerHTML="OK",s.addEventListener("click",function(){n.callback(),t(l)}),o.classList.add("button","button--narrow"),o.innerHTML="Cancel",o.addEventListener("click",function(){t(l)}),e.appendChild(s),e.appendChild(o),l.appendChild(e)}return"error"!==n.type&&"confirm"!==n.type&&setTimeout(function(){t(l)},s),l}return{notify:function(t,s){e(n(t,s))}}}(),nameChecker=function(){function e(e,t){let n=e;for(let e in t)if(t.hasOwnProperty(e)){const s=new RegExp(e,"g");n=n.replace(s,t[e])}return n}function t(t){return e(t,{"Ä":"Ae","Ö":"Oe","Ü":"ue","ä":"ae","ö":"oe","ü":"ue","ß":"ss"})}function n(t){return e(t,{"/":"%2F"})}function s(t){return e(t,{"[()]":""})}function l(t){return e(t,{"\n":" "})}function o(t){return e(t,{"-":" "})}function a(t){return e(t,{"\\s":""})}function u(t){return e(t,{"\\s\\s+":" "})}function r(t,n){const s={};s[n]="";try{return e(t,s)}catch(e){if("SyntaxError"===e.name)return animation.notify(e.message,{type:"error"}),t}}function i(e,t){const n=[];for(let s=0;s<t.length;s++)""!==t[s]&&n.push(e+" "+t[s]);return n}function c(e,t){const n=[];for(let s in t)if(t.hasOwnProperty(s)&&s.length>t[s].replacements[0].length){const l=new RegExp(s,"gi");let o;for(;null!=(o=l.exec(e));){const e=[];e.push(o),e.push(t[s]),e.push(o.index),n.push(e)}}return n}function m(e){return e.sort(function(e,t){const n=e[1].priority,s=t[1].priority,l=e[2],o=t[2];return n==s?o-l:s-n})}function d(e,t){const n=m(t),s=n[0][2];return e.substring(0,s)+e.substring(s).replace(n[0][0],n[0][1].replacements[0])}function p(e,t,n){if(e.length<=n)return e;{const s=c(e,t);return s.length<1?e:p(d(e,s),t,n)}}function h(e,t,n,s){const l=[],o=i(e,t);let a=e;o.length>0&&(a=o.reduce(function(e,t){return e.length>t.length?e:t}));const u=a.length-e.length,r=s.map(function(e){return e-u});for(let t=0;t<r.length;t++){const s=p(e,n,r[t]);l.push(s)}return l}return Object.prototype.hasOwnPropertyCI=function(e){return Object.keys(this).filter(function(t){return t.toLowerCase()===e.toLowerCase()}).length>0},{replaceUmlauts:t,maxLength:function(e,t){return e.length>t},removeBreaks:l,translateLink:function(e){return"https://translate.google.com/#auto/en/"+n(encodeURI(l(e)))},addShareClasses:i,shortenProcess:function(e,n,l,c,m,d){const p=n.removeRegex?r(e,d):e,f=n.removeParens?s(p):p,y=n.removeDashes?o(f):f,v=n.removeWhitespace?a(y):y,b=u(n.replaceUmlauts?t(v):v),g=n.shortenName?h(b,c,l,m):[b,b,b];for(let e=0;e<g.length;e++){const t=2===e?"In-House":1===e?"Short":"";let n;(n=c.length>0?i(g[e],c).reduce(function(e,t){return e.length>t.length?e:t}):g[e]).length>m[e]&&animation.notify("Couldn't fully shorten "+t+" Name.",{type:"warning"})}return{shortenedName:g[0],shortenedNameShort:g[1],shortenedNameInHouse:g[2]}}}}(),loadRules=function(){return{load:function(e){if(localStorage.localRulesSaved=!0,void 0!==localStorage.localRules)e(localStorage.localRules),animation.notify("Local rules loaded!",{type:"success"});else{animation.notify("No local rules found!",{type:"warning"});const t=new XMLHttpRequest;t.overrideMimeType("application/json"),t.open("GET","js/rules.json",!0),t.onreadystatechange=function(){4==t.readyState&&("200"==t.status?(e(t.responseText),animation.notify("Default rules loaded!",{type:"success"})):(e("{}"),animation.notify("No default rules found! Please add own rules.",{type:"error"})))},t.send(null)}},modify:function(e,t,n){"saved"===t?(localStorage.localRules=JSON.stringify(e),localStorage.localRulesSaved=!0):"changed"===t&&(localStorage.localRulesSaved=!1),n()},uploadRules:function(e,t){const n=["json","txt"],s=e.target;if(s.files&&s.files[0]){const e=s.files[0].name.split(".").pop().toLowerCase();if(n.indexOf(e)<0)animation.notify("Only .json and .txt files allowed!",{type:"error"});else if(s.files[0].size>1e6)animation.notify("Max. "+Math.floor(1)+"MB allowed",{type:"error"});else{const e=new FileReader;e.onloadstart=function(e){animation.notify("Uploading rules.")},e.onerror=function(e){animation.notify("Upload not successful.",{type:"error"})},e.onload=function(){t(e.result),animation.notify("Rules uploaded successfully.",{type:"success"})},e.readAsText(s.files[0])}}}}}(),elements={inputName:document.querySelector("#inputName"),outputName:document.querySelector("#outputName"),outputShortName:document.querySelector("#outputShortName"),outputInHouseName:document.querySelector("#outputInHouseName"),lenOutputName:document.querySelector("#lenOutputName"),lenOutputShortName:document.querySelector("#lenOutputShortName"),lenOutputInHouseName:document.querySelector("#lenOutputInHouseName"),lenName:document.querySelector("#lenName"),inputObj:document.querySelector("#inputObj"),lenObj:document.querySelector("#lenObj"),showRules:document.querySelector("#showRules"),divRules:document.querySelector("#sectionRules"),shareClassesOutput:document.querySelector("#shareClassesOutput"),shareClassesShortOutput:document.querySelector("#shareClassesShortOutput"),shareClassesInHouseOutput:document.querySelector("#shareClassesInHouseOutput"),shareClassesInput:document.querySelector("#shareClasses"),btnsRules:document.querySelector("#btnsRules"),btnSaveRules:document.querySelector("#btnSaveRules"),btnResetRules:document.querySelector("#btnResetRules"),btnCloseRules:document.querySelector("#btnCloseRules"),btnRemoveRules:document.querySelector("#btnRemoveRules"),btnDownloadRules:document.querySelector("#btnDownloadRules"),btnUploadRules:document.querySelector("#btnUploadRules"),rulesSaved:document.querySelector("#rulesSaved"),tableRules:document.querySelector("#tableRules"),tableBody:document.querySelector("#tableRules tbody"),btnAddRule:document.querySelector("#btnAddRule"),buttonShorten:document.querySelector("#buttonShorten"),addRuleKey:document.querySelector("#addRuleKey"),addRuleValue:document.querySelector("#addRuleValue"),addRulePriority:document.querySelector("#addRulePriority"),btnObjUmlauts:document.querySelector("#buttonObjUmlauts"),btnObjBreaks:document.querySelector("#buttonObjBreaks"),linkTranslate:document.querySelector("#linkTranslate"),btnExportNames:document.querySelector("#btnExportNames"),removeSpecial:document.querySelector("#removeSpecial"),removeParens:document.querySelector("#removeParens"),shortenNames:document.querySelector("#shortenNames"),removeDashes:document.querySelector("#removeDashes"),removeWhitespace:document.querySelector("#removeWhitespace"),manualWrapper:document.querySelector("#manualWrapper"),manualClose:document.querySelector("#manualClose"),manualOpen:document.querySelector("#manualOpen"),removeRegex:document.querySelector("#removeRegex")};!function(e){function t(e,t,n){t.innerHTML=e.length,nameChecker.maxLength(e,n)?t.classList.contains("length--warning")||t.classList.add("length--warning"):t.classList.contains("length--warning")&&t.classList.remove("length--warning")}function n(e){const t=document.createRange();t.selectNodeContents(e);const n=window.getSelection();n.removeAllRanges(),n.addRange(t)}function s(e){n(e);try{const e=document.execCommand("copy"),t=e?"successful":"unsuccessful",n=e?"success":"error";animation.notify("Copying text was "+t+"!",{type:n})}catch(e){animation.notify("Unable to copy!",{type:"error"})}}function l(e){const t=e.target;t.style.height="inherit",t.style.height=t.scrollHeight+4+"px"}function o(e,t){e.addEventListener("click",function(){s(t)})}function a(e,n,s,l){const a=n.value.length>0?n.value.split("\n"):[];for(;s.firstChild;)s.removeChild(s.firstChild);const u=nameChecker.addShareClasses(e,a);for(let e=0;e<u.length;e++){const n=s.id+"_"+e,a=document.createElement("li");a.setAttribute("tabIndex","0"),a.setAttribute("contentEditable","true"),a.classList+="shareclass-list__item";const r=document.createTextNode(u[e]);a.appendChild(r);const i=document.createElement("span");i.setAttribute("id",n),i.setAttribute("data-tooltip","Copy"),i.classList+="shareclass-list__length",t(r,i,l),s.appendChild(a),s.appendChild(i),o(i,a)}}function u(n,s,l,o){const u=n.value,r=e[l];t(u,s,r),a(u,elements.shareClassesInput,o,r)}function r(e){loadRules.modify(v,e,function(){"saved"===e?(animation.notify("Local rules saved!",{type:"success"}),elements.rulesSaved.innerHTML="",elements.btnSaveRules.classList.remove("button--unsaved")):"changed"===e&&(elements.rulesSaved.innerHTML="*",elements.btnSaveRules.classList.add("button--unsaved"))})}function i(e,t,n,s){const l=n<=99?n:99;""!==e&&""!==t?v.hasOwnPropertyCI(e)?animation.notify("Rule already exists!",{type:"warning"}):(v[e]={priority:l,replacements:[t]},r("changed"),m(elements.tableBody,e,t,n),s()):animation.notify("Please check rule input!",{type:"warning"})}function c(e,t,n){delete v[e],r("changed"),t.removeChild(n)}function m(e,t,n,s){const l=document.createElement("tr"),o=document.createElement("td"),a=document.createElement("td"),u=document.createElement("td"),r=document.createElement("td"),i=document.createElement("button");l.classList+="table-rules__row",o.classList+="table-rules__item",a.classList+="table-rules__item",u.classList+="table-rules__item table-rules__item--narrower",r.classList+="table-rules__item table-rules__item--narrow",i.innerHTML="Remove",i.classList+="button button--intable",o.innerHTML=t,a.innerHTML=n,u.innerHTML=s,r.appendChild(i),l.appendChild(o),l.appendChild(a),l.appendChild(u),l.appendChild(r),e.appendChild(l),i.addEventListener("click",function(n){c(t,e,l)})}function d(e,t){t.innerHTML="";try{for(let n in e)e.hasOwnProperty(n)&&m(t,n,e[n].replacements[0],e[n].priority)}catch(e){animation.notify("There was a problem loading local rules. Please reset to default or remove all rules.",{type:"error"})}}function p(){loadRules.load(function(e){d(v=JSON.parse(e),elements.tableBody)})}function h(){const e=elements.shareClassesOutput.getElementsByTagName("li"),t=elements.shareClassesShortOutput.getElementsByTagName("li"),n=elements.shareClassesInHouseOutput.getElementsByTagName("li");if(0===e.length&&0===t.length&&0===n.length)animation.notify("Nothing to export!",{type:"error"});else{const s=[["Name","Short Name","In-House Name"]];for(let l=0;l<e.length;l++){const o=[];o[0]=e[l].innerHTML,o[1]=t[l].innerHTML,o[2]=n[l].innerHTML,s.push(o)}const l=[];s.forEach(function(e,t){const n=e.join(",");l.push(0==t?"data:text/csv;charset=utf-8,"+n:n)});const o=l.join("\n"),a=encodeURI(o),u=document.createElement("a");u.setAttribute("href",a),u.setAttribute("download","names.csv"),animation.notify("Exporting to CSV!"),document.body.appendChild(u),u.click(),document.body.removeChild(u)}}function f(){elements.manualWrapper.style.display="flex",elements.manualWrapper.classList.add("manual--visible")}function y(){elements.manualWrapper.classList.remove("manual--visible"),elements.manualWrapper.addEventListener("transitionend",function(e){})}let v;p(),elements.showRules.addEventListener("click",function(e){elements.divRules.classList.contains("section__rules--show")?elements.divRules.classList.remove("section__rules--show"):elements.divRules.classList.add("section__rules--show")}),elements.btnAddRule.addEventListener("click",function(e){i(elements.addRuleKey.value,elements.addRuleValue.value,elements.addRulePriority.value,function(){elements.addRuleKey.value="",elements.addRuleValue.value="",elements.addRulePriority.value=0,elements.tableBody.scrollTop=elements.tableBody.scrollHeight})}),elements.btnsRules.addEventListener("click",function(e){switch(e.target){case elements.btnSaveRules:r("saved");break;case elements.btnResetRules:animation.notify("Do you want to reset to default rules?",{type:"confirm",callback:function(){animation.notify("Rules reset to default!"),localStorage.removeItem("localRules"),localStorage.removeItem("localRulesSaved"),v=p()}});break;case elements.btnRemoveRules:animation.notify("Do you want to remove all rules?",{type:"confirm",callback:function(){for(v={};elements.tableBody.firstChild;)elements.tableBody.removeChild(elements.tableBody.firstChild);r("changed")}});break;case elements.btnDownloadRules:const t="data:text/json;charset=utf-8,"+JSON.stringify(v),n=encodeURI(t),s=document.createElement("a");s.setAttribute("href",n),s.setAttribute("download","rules.json"),animation.notify("Exporting to JSON!"),document.body.appendChild(s),s.click(),document.body.removeChild(s);break;case elements.btnUploadRules:e.target.value=null;break;case elements.btnCloseRules:elements.divRules.classList.remove("section__rules--show")}}),elements.btnUploadRules.addEventListener("change",function(e){loadRules.uploadRules(e,function(e){d(v=JSON.parse(e),elements.tableBody),r("changed")})}),window.addEventListener("beforeunload",function(e){if("false"===localStorage.localRulesSaved){return e.returnValue="You have unsaved rules!","You have unsaved rules!"}}),elements.addRulePriority.addEventListener("input",function(e){elements.addRulePriority.value=elements.addRulePriority.value.replace(/\D+/g,"")}),elements.inputName.addEventListener("input",function(n){t(elements.inputName.value,elements.lenName,e[0])}),elements.inputName.addEventListener("keydown",function(e){13===e.which&&elements.buttonShorten.click()}),elements.outputName.addEventListener("input",function(e){u(elements.outputName,elements.lenOutputName,0,elements.shareClassesOutput)}),elements.outputShortName.addEventListener("input",function(e){u(elements.outputShortName,elements.lenOutputShortName,1,elements.shareClassesShortOutput)}),elements.outputInHouseName.addEventListener("input",function(e){u(elements.outputInHouseName,elements.lenOutputInHouseName,2,elements.shareClassesInHouseOutput)}),elements.shareClassesInput.addEventListener("input",l),elements.buttonShorten.addEventListener("click",function(t){const n=elements.inputName.value,s={};s.replaceUmlauts=elements.removeSpecial.checked,s.removeParens=elements.removeParens.checked,s.shortenName=elements.shortenNames.checked,s.removeDashes=elements.removeDashes.checked,s.removeWhitespace=elements.removeWhitespace.checked,s.removeRegex=""!==elements.removeRegex.value;const l=elements.removeRegex.value,o=elements.shareClassesInput.value.length>0?elements.shareClassesInput.value.split("\n"):[],a=nameChecker.shortenProcess(n,s,v,o,e,l);elements.outputName.value=a.shortenedName,elements.outputShortName.value=a.shortenedNameShort,elements.outputInHouseName.value=a.shortenedNameInHouse,u(elements.outputName,elements.lenOutputName,0,elements.shareClassesOutput),u(elements.outputShortName,elements.lenOutputShortName,1,elements.shareClassesShortOutput),u(elements.outputInHouseName,elements.lenOutputInHouseName,2,elements.shareClassesInHouseOutput)}),elements.btnExportNames.addEventListener("click",function(){h()}),elements.inputObj.addEventListener("input",function(e){t(elements.inputObj.value,elements.lenObj,2e3),elements.linkTranslate.href=nameChecker.translateLink(elements.inputObj.value)}),elements.btnObjUmlauts.addEventListener("click",function(e){elements.inputObj.value=nameChecker.replaceUmlauts(elements.inputObj.value),t(elements.inputObj.value,elements.lenObj,2e3),elements.inputObj.select()}),elements.btnObjBreaks.addEventListener("click",function(e){elements.inputObj.value=nameChecker.removeBreaks(elements.inputObj.value),t(elements.inputObj.value,elements.lenObj,2e3),elements.inputObj.select()}),elements.manualOpen.addEventListener("click",function(e){f()}),elements.manualWrapper.addEventListener("click",function(e){e.target==elements.manualWrapper&&y(),e.target==elements.manualClose&&y()})}([50,30,40]);